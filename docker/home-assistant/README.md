# HomAss, —Ö–æ–º—è–∫ - —Ü–µ–Ω—Ç—Ä —É–º–Ω–æ–≥–æ –¥–æ–º–∞

# –ñ–µ–ª–µ–∑–æ

## Docker
> –ò–∑-–∑–∞ –ø–æ—Å—Ç–æ–ª—è–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–≥–æ–≤ —Å –æ—Ç–≤–∞–ª–∏–≤–∞—é—â–∏–º—Å—è –¥–æ–Ω–≥–ª–æ–º —è *–ø–µ—Ä–µ–µ—Ö–∞–ª —Å –¥–æ–∫–µ—Ä–∞ –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É* (Home Assistant OS) –∏ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å—á–µ–∑–ª–∏!

–ú–Ω–µ —É–¥–æ–±–Ω–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ–∫–µ—Ä –∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–∞—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä - Synology NAS. –ù–æ –µ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è home-assistant: —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –º–æ–∂–Ω–æ –¥–æ–±–∏—Ç—å—Å—è –±–æ–ª—å—à–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ (–≤—Å—Ç–∞–≤–∏—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–ª–∞—Ç—É-–∞–∫—Å–µ–ª–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç—ã —Å –ò–ò), —Ç–∞–∫–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –º–æ–∂–Ω–æ –∑–∞–ø–∏—Ö–Ω—É—Ç—å —Å—Ä–∞–∑—É –≤ —Å–µ—Ç—å —É–º–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –∏ –Ω–µ –¥–µ—Ä–∂–∞—Ç—å –µ–≥–æ –≤ "—á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π" —Å–µ—Ç–∏. 

## Sonoff Zigbee 3.0 dongle
| :exclamation: Sonoff Zigbee 3.0 USB Dongle —Å–¥–æ—Ö —á–µ—Ä–µ–∑ 2 –≥–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –ü–µ—Ä–µ—à–µ–ª –Ω–∞ ‚ÄúSonoff Zigbee 3.0 USB Dongle Plus V2‚Äù (model ‚ÄúZBDongle-E‚Äù)|
|-----------|

–£ —Ö–æ–º—è–∫–∞ –µ—Å—Ç—å —Ä–æ–¥–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Zigbee. –û–Ω–∞ –±—ã–ª–∞ —Ä–∞–Ω—å—à–µ –ø–ª–æ—Ö–∞—è, –∏ —è —Å–ø—Ä—ã–≥–Ω—É–ª –Ω–∞ [zigbee2mqtt](https://github.com/ageev/SmartHome/tree/master/docker/zigbee2mqtt). –°–µ–π—á–∞—Å –±—ã —É–∂–µ, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –æ—Å—Ç–∞–ª—Å—è –Ω–∞ —Ä–æ–¥–Ω–æ–π. 
–ü—Ä–æ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –¥–æ–Ω–≥–ª–∞ –ø–æ—á–∏—Ç–∞–π—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª–µ [zigbee2mqtt](../zigbee2mqtt)
## APC UPS


# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
## docker-compose.yml
```yml
---
version: "3.9"
services:
  home-assistant:
    image: homeassistant/home-assistant
    container_name: home-assistant
    hostname: home-assistant
    environment:
      - PUID=1029
      - PGID=100
      - TZ=Europe/Zurich
    volumes:
      - /volume1/docker/home-assistant:/config
    restart: unless-stopped
    network_mode: "host"
## will be handled by zigbee2mqtt 
#    devices:
#      - /dev/ttyACM0:/dev/ttyACM0 # old SONOFF stick
#      - /dev/ttyUSB0:/dev/ttyUSB0 # sonoff zigbee 3.0 dongle plus 
```
## HACS
HACS - —ç—Ç–æ *–Ω–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π* –º–∞–≥–∞–∑–∏–Ω –∞–¥–¥–æ–Ω–æ–≤ –∫ —Ö–æ–º—è–∫—É. –≠—Ç–æ —Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –•–æ–º—è–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–Ω–∞—Å—Ç–æ—è—â–µ–º—É –º–æ—â–Ω–æ–π —à—Ç—É–∫–æ–π.
HACS –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å GitHab. 

## –ü–æ–ª–µ–∑–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

## "–ê–ª–∏—Å–∞, –Ω–∞–π–¥–∏ –ø—É–ª—å—Ç –æ—Ç —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞"
–Ø–Ω–¥–µ–∫—Å —Å—Ç–∞–Ω—Ü–∏—è, —É—Å–ª—ã—à–∞–≤ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –Ω–∞—á–Ω—ë—Ç –ø–æ–∏—Å–∫ –ø—É–ª—å—Ç–∞ –æ—Ç —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞ (–ø—É–ª—å—Ç—ã –æ—Ç Nvidia Shield TV —É–º–µ—é—Ç –ø–∏—Å—á–∞—Ç—å –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø—Ä–∏—Å—Ç–∞–≤–∫–∏). 

–ß—Ç–æ –Ω—É–∂–Ω–æ:
1. –∫–æ–ª–æ–Ω–∫–∞ —Å –ê–ª–∏—Å–æ–π
2. home assistant —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π YandexStation (https://github.com/AlexxIT/YandexStation) —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —á–µ—Ä–µ–∑ HACS
3. Nvidia Shield TV, –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –∫ Home Assisstant —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é AndroidTV —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º ADB Debug (—á–µ—Ä–µ–∑ Wifi –∏ —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–∞ ShieldTV)

### –®–∞–≥ 1 - –¥–æ–±–∞–≤–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ –Ø–Ω–¥–µ–∫—Å–µ
–î–æ–±–∞–≤–ª—è–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π: –ï—Å–ª–∏ —è —Å–∫–∞–∂—É "–ê–ª–∏—Å–∞, –Ω–∞–π–¥–∏ –ø—É–ª—å—Ç –æ—Ç —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞", –ê–ª–∏—Å–∞ —Å–∫–∞–∂–µ—Ç "–ü—É–ª—å—Ç–∏–∫-–ø—É–ª—å—Ç–∏–∫, —Ç—ã –≥–¥–µ?"

### –®–∞–≥ 2 - –¥–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –≤ Home Assistant
```
alias: 'ALISA find REMOTE üì∫ '
description: ''
trigger:
  - platform: event
    event_type: yandex_speaker
    event_data:
      value: –ü—É–ª—å—Ç–∏–∫-–ø—É–ª—å—Ç–∏–∫, —Ç—ã –≥–¥–µ?
condition: []
action:
  - service: script.remote_finder
    data: {}
mode: single
```

### –®–∞–≥ 3 - —Å–æ–∑–¥–∞–µ–º —Å–∫—Ä–∏–ø—Ç script.remote_finder
–û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É scripts –≤ Home Assisstant –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
```
alias: TV Remote Finder
icon: mdi:target
mode: single
sequence:
  - service: androidtv.adb_command
    data:
      command: >-
        am start -a android.intent.action.VIEW -d -n
        com.nvidia.remotelocator/.ShieldRemoteLocatorActivity
      entity_id: media_player.ShieldADB
```

# Nginx Proxy Manager Configuration
—á—Ç–æ–±—ã Home Assistant –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ Nginx Proxy Manager –¥–æ–±–∞–≤—å—Ç–µ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–∞–∫—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```
# this configuration can be used for external access to api/webhook only if NPM/router allows. 

location / {
    if ($remote_addr !~ "^(10\.|172\.(1[6-9]|2[0-9]|3[0-1])\.|192\.168\.|fc00:|fe80:|fd[0-9a-f]{2}:)")  {
        return 301 https://google.com; # redirect non-local IPs to Google.com.
    }
    proxy_pass http://10.0.1.10:8123; # Home Assistant IP
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

location /api/websocket {
    if ($remote_addr !~ "^(10\.|172\.(1[6-9]|2[0-9]|3[0-1])\.|192\.168\.|fc00:|fe80:|fd[0-9a-f]{2}:)")  {
        return 301 https://google.com;
    }
    proxy_pass http://10.0.1.10:8123/api/websocket; # Home Assistant IP
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    }

location /api/webhook {
    proxy_pass http://10.0.1.10:8123/api/webhook; # Home Assistant IP
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    }
```
